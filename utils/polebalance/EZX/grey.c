/*
 *	SGPattern.c  -	Grey Level Pattern File
 *
 *	Relevant Parameters/Variables to be changed:
 *	    PATTERN_HEIGHT :	in SGrapher.h  (#define)
 *	    PATTERN_WIDTH  :	in SGrapher.h  (#define)
 *	    mask	   :	in SGPattern.c (variable initialization)
 */

#include "EZX11.h"


BitMapPoints 	theGrey[NO_GREY_LEVELS];

unsigned int  greyPattern[NO_GREY_LEVELS][PATTERN_HEIGHT] =
	      { 0000, 0000, 0000, 0000, 0000, 0000, 0000, 0000, /* 00 */
		0000, 0000, 0000, 0000, 0000, 0000, 0010, 0000,
		0000, 0001, 0000, 0000, 0000, 0000, 0010, 0000,
		0000, 0001, 0001, 0000, 0000, 0000, 0010, 0000,
		0000, 0001, 0001, 0000, 0000, 0010, 0010, 0000,
		0000, 0001, 0001, 0000, 0000, 0030, 0010, 0000,
		0000, 0201, 0001, 0000, 0000, 0030, 0010, 0000,
		0000, 0201 ,0201, 0000, 0000, 0030, 0010, 0000,
		0000, 0201, 0201, 0000, 0000, 0030, 0030, 0000, /* 08 */
		0000, 0201, 0201, 0000, 0000, 0030, 0034, 0000,
		0000, 0203, 0201, 0000, 0000, 0030, 0034, 0000,
		0000, 0203, 0201, 0000, 0000, 0034, 0034, 0000,
		0000, 0203, 0203, 0000, 0000, 0034, 0034, 0000,
		0000, 0203, 0203, 0000, 0000, 0034, 0034, 0010,
		0000, 0203, 0203, 0001, 0000, 0034, 0034, 0010,
		0001, 0203, 0203, 0001, 0000, 0034, 0034, 0010,
		0001, 0203, 0203, 0001, 0010, 0034, 0034, 0010, /* 16 */
		0001, 0203, 0203, 0001, 0030, 0034, 0034, 0010,
		0201, 0203, 0203, 0001, 0030, 0034, 0034, 0010,
		0201, 0203, 0203, 0201, 0030, 0034, 0034, 0010,
		0201, 0203, 0203, 0201, 0030, 0034, 0034, 0030,
		0201, 0203, 0303, 0201, 0030, 0034, 0034, 0030,
		0201, 0203, 0303, 0201, 0030, 0074, 0034, 0030,
		0201, 0303, 0303, 0201, 0030, 0074, 0034, 0030,
		0201, 0303, 0303, 0201, 0030, 0074, 0074, 0030, /* 24 */
		0201, 0303, 0303, 0201, 0030, 0074, 0074, 0034,
		0203, 0303, 0303, 0201, 0030, 0074, 0074, 0034,
		0203, 0303, 0303, 0203, 0030, 0074, 0074, 0034,
		0203, 0303, 0303, 0203, 0034, 0074, 0074, 0034,
		0203, 0303, 0303, 0203, 0074, 0074, 0074, 0034,
		0203, 0303, 0303, 0303, 0074, 0074, 0074, 0034,
		0303, 0303, 0303, 0303, 0074, 0074, 0074, 0034,
		0303, 0303, 0303, 0303, 0074, 0074, 0074, 0074, /* 32 */
		0307, 0303, 0303, 0303, 0074, 0074, 0074, 0074,
		0307, 0303, 0303, 0303, 0074, 0074, 0074, 0076,
		0307, 0303, 0303, 0303, 0076, 0074, 0074, 0076,
		0307, 0303, 0303, 0307, 0076, 0074, 0074, 0076,
		0307, 0303, 0303, 0347, 0076, 0074, 0074, 0076,
		0307, 0303, 0303, 0347, 0176, 0074, 0074, 0076,
		0307, 0303, 0303, 0347, 0176, 0074, 0074, 0176,
		0347, 0303, 0303, 0347, 0176, 0074, 0074, 0176, /* 40 */
		0347, 0303, 0303, 0347, 0176, 0074, 0076, 0176,
		0347, 0307, 0303, 0347, 0176, 0074, 0076, 0176,
		0347, 0307, 0303, 0347, 0176, 0076, 0076, 0176,
		0347, 0307, 0307, 0347, 0176, 0076, 0076, 0176,
		0357, 0307, 0307, 0347, 0176, 0076, 0076, 0176,
		0357, 0307, 0307, 0347, 0177, 0076, 0076, 0176,
		0357, 0307, 0307, 0347, 0177, 0076, 0076, 0177,
		0357, 0307, 0307, 0367, 0177, 0076, 0076, 0177, /* 48 */
		0357, 0307, 0307, 0377, 0177, 0076, 0076, 0177,
		0357, 0307, 0307, 0377, 0177, 0076, 0076, 0377,
		0357, 0307, 0307, 0377, 0377, 0076, 0076, 0377,
		0377, 0307, 0307, 0377, 0377, 0076, 0076, 0377,
		0377, 0307, 0347, 0377, 0377, 0076, 0076, 0377,
		0377, 0307, 0347, 0377, 0377, 0176, 0076, 0377,
		0377, 0347, 0347, 0377, 0377, 0176, 0076, 0377,
		0377, 0347, 0347, 0377, 0377, 0176, 0176, 0377, /* 56 */
		0377, 0357, 0347, 0377, 0377, 0176, 0176, 0377,
		0377, 0357, 0347, 0377, 0377, 0176, 0177, 0377,
		0377, 0357, 0347, 0377, 0377, 0177, 0177, 0377,
		0377, 0357, 0357, 0377, 0377, 0177, 0177, 0377,
		0377, 0357, 0377, 0377, 0377, 0177, 0177, 0377,
		0377, 0357, 0377, 0377, 0377, 0177, 0377, 0377,
		0377, 0357, 0377, 0377, 0377, 0377, 0377, 0377,
		0377, 0377, 0377, 0377, 0377, 0377, 0377, 0377  /* 64 */
	     };

unsigned int	masks[PATTERN_WIDTH] =
		 { 0x80, 0x40, 0x20, 0x10, 0x08, 0x04, 0x02, 0x01 };


void EZX_InitPatterns()
{
   int i;
   for( i = 0; i < NO_GREY_LEVELS; i++ )
      EZX_CreatePattern( &greyPattern[i][0], &theGrey[i]);
}

void EZX_CreatePattern(pattern, mapPoints)
     unsigned int pattern[PATTERN_HEIGHT];
     BitMapPoints *mapPoints;
{
   int	i, j, count=0, x=0, y=0;
 
   mapPoints->points =
      (XPoint *) malloc(sizeof(XPoint) * (PATTERN_WIDTH * PATTERN_HEIGHT));
   if( mapPoints->points == NULL ) {
      fprintf( stderr, "\nCreatePattern: malloc error, NULL returned" );
      exit(1);
   }

   for( i = 0; i < PATTERN_HEIGHT; i++ )
      for( j = 0; j < PATTERN_WIDTH; j++ )
	 if( pattern[i] & masks[j] ) {
	    if( count == 0 ) {
	       mapPoints->start.x = PATTERN_WIDTH - 1 - j;
	       mapPoints->start.y = i;
	    }
	    else {
	       /*... points are in relative coordinate of previous pt ...*/
	       mapPoints->points[count].x = PATTERN_WIDTH - 1 - j - x;
	       mapPoints->points[count].y = i - y;
	    }
	    x = PATTERN_WIDTH - 1 - j;  y = i;
	    count++;
	 }
   mapPoints->npoints = count;
}


void EZX_DrawPattern(w, x, y, pattern)
     EZXW_p w;
     int	 x, y;
     BitMapPoints *pattern;
{
   EZX_ClearRectangle(w, x, y, PATTERN_WIDTH, PATTERN_HEIGHT );
   pattern->points[0].x = x + pattern->start.x;
   pattern->points[0].y = y + pattern->start.y;
   EZX_DrawPoints(w, pattern->npoints, pattern->points );
}


void EZX_DrawGrey(w, x, y, g)
     EZXW_p w;
     int x,y,g;
{
   g = (g < 0) ? 0 : ((g >= NO_GREY_LEVELS) ? NO_GREY_LEVELS-1 : g);
   EZX_DrawPattern(w, x, y, &theGrey[g]);
}
